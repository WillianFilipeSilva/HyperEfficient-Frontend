<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="apple-touch-icon" sizes="76x76" href="../../assets/img/logo.svg" />
    <link rel="icon" type="image/png" href="../../assets/img/logo.svg" />
    <title>HyperEfficient - Relatorios</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <link href="../../assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="../../assets/css/nucleo-svg.css" rel="stylesheet" />
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <link href="../../assets/css/dashboard-tailwind.css" rel="stylesheet" />
  </head>

  <body class="m-0 font-sans text-base antialiased font-normal dark:bg-slate-900 leading-default bg-gray-50 text-slate-500">
    <div class="absolute w-full bg-blue-500 dark:hidden min-h-75"></div>

    <aside class="fixed inset-y-0 flex-wrap items-center justify-between block w-full p-0 my-4 overflow-y-auto antialiased transition-transform duration-200 -translate-x-full bg-white border-0 shadow-xl dark:shadow-none dark:bg-slate-850 xl:ml-6 max-w-64 ease-nav-brand z-990 rounded-2xl xl:left-0 xl:translate-x-0" aria-expanded="false">
      <div class="h-19">
        <i class="absolute top-0 right-0 p-4 opacity-50 cursor-pointer fas fa-times dark:text-white text-slate-400 xl:hidden" sidenav-close></i>
        <a class="block px-8 py-6 m-0 text-sm whitespace-nowrap dark:text-white text-slate-700" href="dashboard.html" target="_blank">
          <img src="../../assets/img/logo.svg" class="inline h-full max-w-full transition-all duration-200 dark:hidden ease-nav-brand max-h-8" alt="main_logo" />
          <img src="../../assets/img/logo.svg" class="hidden h-full max-w-full transition-all duration-200 dark:inline ease-nav-brand max-h-8" alt="main_logo" />
          <span class="ml-1 font-semibold transition-all duration-200 ease-nav-brand">HyperEfficient</span>
        </a>
      </div>

      <hr class="h-px mt-0 bg-transparent bg-gradient-to-r from-transparent via-black/40 to-transparent dark:bg-gradient-to-r dark:from-transparent dark:via-white dark:to-transparent" />

      <div class="items-center block w-auto max-h-screen overflow-auto h-sidenav grow basis-full">
        <ul class="flex flex-col pl-0 mb-0">

          <li class="mt-0.5 w-full">
            <a class="py-2.7 bg-blue-500/13 dark:text-white dark:opacity-80 text-sm ease-nav-brand my-0 mx-2 flex items-center whitespace-nowrap rounded-lg px-4 font-semibold text-slate-700 transition-colors" href="../dashboard.html">
              <div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-center stroke-0 text-center xl:p-2.5">
                <i class="relative top-0 text-sm leading-normal text-blue-500 ni ni-tv-2"></i>
              </div>
              <span class="ml-1 duration-300 opacity-100 pointer-events-none ease">Dashboard</span>
            </a>
          </li>
          
          <li class="mt-0.5 w-full">
            <a class="py-2.7 text-sm ease-nav-brand my-0 mx-2 flex items-center whitespace-nowrap px-4 transition-colors dark:text-white dark:opacity-80" href="../listagem.html">
              <div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-center stroke-0 text-center xl:p-2.5">
                <i class="relative top-0 leading-normal text-orange-500 ni ni-calendar-grid-58 text-sm"></i>
              </div>
              <span class="ml-1 duration-300 opacity-100 pointer-events-none ease">Listagem</span>
            </a>
          </li>

          <li class="mt-0.5 w-full">
            <a class="py-2.7 text-sm ease-nav-brand my-0 mx-2 flex items-center whitespace-nowrap px-4 transition-colors dark:text-white dark:opacity-80" href="../Setor/listagem-setor.html">
              <div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-center stroke-0 text-center xl:p-2.5">
                <i class="relative top-0 leading-normal text-blue-500 ni ni-building text-sm"></i>
              </div>
              <span class="ml-1 duration-300 opacity-100 pointer-events-none ease">Setores</span>
            </a>
          </li>

          <li class="w-full mt-4">
            <h6 class="pl-6 ml-2 font-bold leading-tight uppercase dark:text-white text-xs opacity-60">Usuario</h6>
          </li>

          <li class="mt-0.5 w-full">
            <a class="dark:text-white dark:opacity-80 py-2.7 text-sm ease-nav-brand my-0 mx-2 flex items-center whitespace-nowrap px-4 transition-colors" href="../perfil.html">
              <div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-center stroke-0 text-center xl:p-2.5">
                <i class="relative top-0 leading-normal text-slate-700 ni ni-single-02 text-sm"></i>
              </div>
              <span class="ml-1 duration-300 opacity-100 pointer-events-none ease">Perfil</span>
            </a>
          </li>

          <li class="mt-0.5 w-full">
            <a class="py-2.7 text-sm ease-nav-brand my-0 mx-2 flex items-center whitespace-nowrap px-4 transition-colors dark:text-white dark:opacity-80" href="../login.html">
              <div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-center stroke-0 text-center xl:p-2.5">
                <i class="relative top-0 text-sm leading-normal text-orange-500 ni ni-single-copy-04"></i>
              </div>
              <span class="ml-1 duration-300 opacity-100 pointer-events-none ease">Login</span>
            </a>
          </li>

          <li class="mt-0.5 w-full">
            <a class="py-2.7 text-sm ease-nav-brand my-0 mx-2 flex items-center whitespace-nowrap px-4 transition-colors dark:text-white dark:opacity-80" href="../cadastro.html">
              <div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-center stroke-0 text-center xl:p-2.5">
                <i class="relative top-0 text-sm leading-normal text-cyan-500 ni ni-collection"></i>
              </div>
              <span class="ml-1 duration-300 opacity-100 pointer-events-none ease">Cadastrar</span>
            </a>
          </li>

          <li class="mt-0.5 w-full">
            <a class="py-2.7 text-sm ease-nav-brand my-0 mx-2 flex items-center whitespace-nowrap px-4 transition-colors dark:text-white dark:opacity-80" href="javascript:;" id="logoutBtn">
              <div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-center stroke-0 text-center xl:p-2.5">
                <i class="relative top-0 leading-normal text-red-500 text-sm ni ni-button-power"></i>
              </div>
              <span class="ml-1 duration-300 opacity-100 pointer-events-none ease">Sair</span>
            </a>
          </li>
        </ul>
      </div>

    </aside>

    <main class="relative h-full max-h-screen transition-all duration-200 ease-in-out xl:ml-68 rounded-xl">
      <!-- Navbar -->
      <nav class="relative flex flex-wrap items-center justify-between px-0 py-2 mx-6 transition-all ease-in shadow-none duration-250 rounded-2xl lg:flex-nowrap lg:justify-start" navbar-main navbar-scroll="false">
        <div class="flex items-center justify-between w-full mx-auto flex-wrap-inherit">
          <nav>
            <ol class="flex flex-wrap pt-1 mr-12 bg-transparent rounded-lg sm:mr-16">
              <li class="text-sm leading-normal">
                <a class="text-white opacity-50" href="javascript:;">Páginas</a>
              </li>
              <li class="text-sm pl-2 capitalize leading-normal text-white before:float-left before:pr-2 before:text-white before:content-['/']" aria-current="page">Relatorios</li>
            </ol>
            <h6 class="mb-0 font-bold text-white capitalize">Relatorios</h6>
          </nav>

          <div class="flex items-center mt-2 grow sm:mt-0 sm:mr-6 md:mr-0 lg:flex lg:basis-auto">
            <div class="flex items-center md:ml-auto">
              <div class="relative flex flex-wrap items-stretch w-full transition-all rounded-lg ease">
                <span class="text-sm ease leading-5.6 absolute z-50 -ml-px flex h-full items-center whitespace-nowrap rounded-lg rounded-tr-none rounded-br-none border border-r-0 border-transparent bg-transparent py-2 px-2.5 text-center font-normal text-slate-500 transition-all">
                  <i class="fas fa-search"></i>
                </span>
                <input type="text" class="pl-9 text-sm focus:shadow-primary-outline ease w-1/100 leading-5.6 relative -ml-px block min-w-0 flex-auto rounded-lg border border-solid border-gray-300 dark:bg-slate-850 dark:text-white bg-white bg-clip-padding py-2 pr-3 text-gray-700 transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:transition-shadow" placeholder="Buscar" />
              </div>
            </div>
          </div>
        </div>
      </nav>

      <!-- cards -->
      <div class="w-full px-6 py-6 mx-auto">
        <div class="flex flex-wrap -mx-3">
          <!-- card1: Quantidade de Setores -->
          <div class="w-full max-w-full px-3 mb-6 sm:w-1/2 sm:flex-none xl:mb-0 xl:w-1/4">
            <div class="relative flex flex-col min-w-0 break-words bg-white shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">
              <div class="flex-auto p-4">
                <div class="flex flex-row -mx-3">
                  <div class="flex-none w-2/3 max-w-full px-3">
                    <div>
                      <p class="mb-0 font-sans text-sm font-semibold leading-normal uppercase dark:text-white dark:opacity-60">Setores</p>
                      <h5 class="mb-2 font-bold dark:text-white" id="cardSetores">-</h5>
                      <p class="mb-0 dark:text-white dark:opacity-60">
                        Total de setores
                      </p>
                    </div>
                  </div>
                  <div class="px-3 text-right basis-1/3">
                    <div class="inline-block w-12 h-12 text-center rounded-circle bg-gradient-to-tl from-blue-500 to-violet-500">
                      <i class="ni ni-building leading-none text-lg relative top-3.5 text-white"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- card2: Quantidade de Equipamentos -->
          <div class="w-full max-w-full px-3 mb-6 sm:w-1/2 sm:flex-none xl:mb-0 xl:w-1/4">
            <div class="relative flex flex-col min-w-0 break-words bg-white shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">
              <div class="flex-auto p-4">
                <div class="flex flex-row -mx-3">
                  <div class="flex-none w-2/3 max-w-full px-3">
                    <div>
                      <p class="mb-0 font-sans text-sm font-semibold leading-normal uppercase dark:text-white dark:opacity-60">Equipamentos</p>
                      <h5 class="mb-2 font-bold dark:text-white" id="cardEquipamentos">-</h5>
                      <p class="mb-0 dark:text-white dark:opacity-60">
                        Total de equipamentos
                      </p>
                    </div>
                  </div>
                  <div class="px-3 text-right basis-1/3">
                    <div class="inline-block w-12 h-12 text-center rounded-circle bg-gradient-to-tl from-green-500 to-emerald-500">
                      <i class="ni ni-settings-gear-65 leading-none text-lg relative top-3.5 text-white"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- card3: Tempo Total de Uso (horas) -->
          <div class="w-full max-w-full px-3 mb-6 sm:w-1/2 sm:flex-none xl:mb-0 xl:w-1/4">
            <div class="relative flex flex-col min-w-0 break-words bg-white shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">
              <div class="flex-auto p-4">
                <div class="flex flex-row -mx-3">
                  <div class="flex-none w-2/3 max-w-full px-3">
                    <div>
                      <p class="mb-0 font-sans text-sm font-semibold leading-normal uppercase dark:text-white dark:opacity-60">Tempo de Uso</p>
                      <h5 class="mb-2 font-bold dark:text-white" id="cardTempoUso">-</h5>
                      <p class="mb-0 dark:text-white dark:opacity-60">
                        Total de horas de uso
                      </p>
                    </div>
                  </div>
                  <div class="px-3 text-right basis-1/3">
                    <div class="inline-block w-12 h-12 text-center rounded-circle bg-gradient-to-tl from-orange-500 to-yellow-500">
                      <i class="ni ni-watch-time leading-none text-lg relative top-3.5 text-white"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- card4: Gasto Energético Total (kWh) -->
          <div class="w-full max-w-full px-3 sm:w-1/2 sm:flex-none xl:w-1/4">
            <div class="relative flex flex-col min-w-0 break-words bg-white shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">
              <div class="flex-auto p-4">
                <div class="flex flex-row -mx-3">
                  <div class="flex-none w-2/3 max-w-full px-3">
                    <div>
                      <p class="mb-0 font-sans text-sm font-semibold leading-normal uppercase dark:text-white dark:opacity-60">Gasto Energético</p>
                      <h5 class="mb-2 font-bold dark:text-white" id="cardGastoEnergetico">-</h5>
                      <p class="mb-0 dark:text-white dark:opacity-60">
                        Total de kWh consumidos
                      </p>
                    </div>
                  </div>
                  <div class="px-3 text-right basis-1/3">
                    <div class="inline-block w-12 h-12 text-center rounded-circle bg-gradient-to-tl from-cyan-500 to-blue-500">
                      <i class="ni ni-bulb-61 leading-none text-lg relative top-3.5 text-white"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="w-full flex flex-wrap mt-6 -mx-0">
          <div class="w-full px-0 mt-0">
            <div class="border-black/12.5 dark:bg-slate-850 dark:shadow-dark-xl shadow-xl relative z-20 flex min-w-0 flex-col break-words rounded-2xl border-0 border-solid bg-white bg-clip-border">
              <div class="border-black/12.5 mb-0 rounded-t-2xl border-b-0 border-solid p-6 pt-4 pb-0">
                <h6 class="capitalize dark:text-white">Visão Geral das Vendas</h6>
                <p class="mb-0 text-sm leading-normal dark:text-white dark:opacity-60">
                  <i class="fa fa-arrow-up text-emerald-500"></i>
                  <span class="font-semibold">4% a mais</span> em 2021
                </p>
              </div>
              <div class="flex-auto p-4">
                <div>
                  <canvas id="chart-line" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex flex-wrap mt-6 -mx-3">
          <div class="w-full max-w-full px-3 mt-0 mb-6 lg:mb-0 lg:w-7/12 lg:flex-none">
            <div class="relative flex flex-col min-w-0 break-words bg-white border-0 border-solid shadow-xl dark:bg-slate-850 dark:shadow-dark-xl dark:bg-gray-950 border-black-125 rounded-2xl bg-clip-border">
              <div class="p-4 pb-0 mb-0 rounded-t-4">
                <div class="flex justify-between">
                  <h6 class="mb-2 dark:text-white">Estatísticas por setor</h6>
                </div>
              </div>
              <div class="overflow-x-auto">
                <table class="items-center w-full mb-4 align-top border-collapse border-gray-200 dark:border-white/40">
                  <tbody id="estatisticasSetoresBody">
                    <!-- Conteúdo dinâmico -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <div class="w-full max-w-full px-3 mt-0 lg:w-5/12 lg:flex-none">
            <div class="border-black/12.5 shadow-xl dark:bg-slate-850 dark:shadow-dark-xl relative flex min-w-0 flex-col break-words rounded-2xl border-0 border-solid bg-white bg-clip-border">
              <div class="p-4 pb-0 rounded-t-4">
                <h6 class="mb-0 dark:text-white">Categorias</h6>
              </div>
              <div class="flex-auto p-4">
                <ul class="flex flex-col pl-0 mb-0 rounded-lg">
                  <li class="relative flex justify-between py-2 pr-4 mb-2 border-0 rounded-t-lg rounded-xl text-inherit">
                    <div class="flex items-center">
                      <div class="inline-block w-8 h-8 mr-4 text-center text-black bg-center shadow-sm fill-current stroke-none bg-gradient-to-tl from-zinc-800 to-zinc-700 dark:bg-gradient-to-tl dark:from-slate-750 dark:to-gray-850 rounded-xl">
                        <i class="text-white ni ni-mobile-button relative top-0.75 text-xxs"></i>
                      </div>
                      <div class="flex flex-col">
                        <h6 class="mb-1 text-sm leading-normal text-slate-700 dark:text-white">Produção</h6>
                        <span class="text-xs leading-tight dark:text-white/80">250 em estoque, <span class="font-semibold">346+ vendidos</span></span>
                      </div>
                    </div>
                    <div class="flex">
                      <button class="group ease-in leading-pro text-xs rounded-3.5xl p-1.2 h-6.5 w-6.5 mx-0 my-auto inline-block cursor-pointer border-0 bg-transparent text-center align-middle font-bold text-slate-700 shadow-none transition-all dark:text-white"><i class="ni ease-bounce text-2xs group-hover:translate-x-1.25 ni-bold-right transition-all duration-200" aria-hidden="true"></i></button>
                    </div>
                  </li>
                  <li class="relative flex justify-between py-2 pr-4 mb-2 border-0 rounded-xl text-inherit">
                    <div class="flex items-center">
                      <div class="inline-block w-8 h-8 mr-4 text-center text-black bg-center shadow-sm fill-current stroke-none bg-gradient-to-tl from-zinc-800 to-zinc-700 dark:bg-gradient-to-tl dark:from-slate-750 dark:to-gray-850 rounded-xl">
                        <i class="text-white ni ni-tag relative top-0.75 text-xxs"></i>
                      </div>
                      <div class="flex flex-col">
                        <h6 class="mb-1 text-sm leading-normal text-slate-700 dark:text-white">Vendas</h6>
                        <span class="text-xs leading-tight dark:text-white/80">123 fechadas, <span class="font-semibold">15 abertas</span></span>
                      </div>
                    </div>
                    <div class="flex">
                      <button class="group ease-in leading-pro text-xs rounded-3.5xl p-1.2 h-6.5 w-6.5 mx-0 my-auto inline-block cursor-pointer border-0 bg-transparent text-center align-middle font-bold text-slate-700 shadow-none transition-all dark:text-white"><i class="ni ease-bounce text-2xs group-hover:translate-x-1.25 ni-bold-right transition-all duration-200" aria-hidden="true"></i></button>
                    </div>
                  </li>
                  <li class="relative flex justify-between py-2 pr-4 mb-2 border-0 rounded-b-lg rounded-xl text-inherit">
                    <div class="flex items-center">
                      <div class="inline-block w-8 h-8 mr-4 text-center text-black bg-center shadow-sm fill-current stroke-none bg-gradient-to-tl from-zinc-800 to-zinc-700 dark:bg-gradient-to-tl dark:from-slate-750 dark:to-gray-850 rounded-xl">
                        <i class="text-white ni ni-box-2 relative top-0.75 text-xxs"></i>
                      </div>
                      <div class="flex flex-col">
                        <h6 class="mb-1 text-sm leading-normal text-slate-700 dark:text-white">Estoque</h6>
                        <span class="text-xs leading-tight dark:text-white/80">1 ativo, <span class="font-semibold">40 fechadas</span></span>
                      </div>
                    </div>
                    <div class="flex">
                      <button class="group ease-in leading-pro text-xs rounded-3.5xl p-1.2 h-6.5 w-6.5 mx-0 my-auto inline-block cursor-pointer border-0 bg-transparent text-center align-middle font-bold text-slate-700 shadow-none transition-all dark:text-white"><i class="ni ease-bounce text-2xs group-hover:translate-x-1.25 ni-bold-right transition-all duration-200" aria-hidden="true"></i></button>
                    </div>
                  </li>
                  <li class="relative flex justify-between py-2 pr-4 border-0 rounded-b-lg rounded-xl text-inherit">
                    <div class="flex items-center">
                      <div class="inline-block w-8 h-8 mr-4 text-center text-black bg-center shadow-sm fill-current stroke-none bg-gradient-to-tl from-zinc-800 to-zinc-700 dark:bg-gradient-to-tl dark:from-slate-750 dark:to-gray-850 rounded-xl">
                        <i class="text-white ni ni-satisfied relative top-0.75 text-xxs"></i>
                      </div>
                      <div class="flex flex-col">
                        <h6 class="mb-1 text-sm leading-normal text-slate-700 dark:text-white">Atendimento</h6>
                        <span class="text-xs leading-tight dark:text-white/80"><span class="font-semibold">+ 430 </span></span>
                      </div>
                    </div>
                    <div class="flex">
                      <button class="group ease-in leading-pro text-xs rounded-3.5xl p-1.2 h-6.5 w-6.5 mx-0 my-auto inline-block cursor-pointer border-0 bg-transparent text-center align-middle font-bold text-slate-700 shadow-none transition-all dark:text-white"><i class="ni ease-bounce text-2xs group-hover:translate-x-1.25 ni-bold-right transition-all duration-200" aria-hidden="true"></i></button>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <footer class="pt-4">
          <div class="w-full px-6 mx-auto">
            <div class="text-sm leading-normal text-center text-slate-500 lg:text-left">
              © 2025
              feito <i class="fa fa-heart"></i> por
              <span class="font-semibold text-slate-700 dark:text-white" target="_blank">HyperEfficient</span>
            </div>
          </div>
        </footer>
      </div>
    </main>
    
  </body>
  <script src="../../assets/js/plugins/chartjs.min.js" async></script>
  <script src="../../assets/js/plugins/perfect-scrollbar.min.js" async></script>
  <script src="../../assets/js/dashboard-tailwind.js?v=1.0.1" async></script>
  <script src="../../assets/js/api-config.js"></script>
  <script src="../../assets/js/utils.js"></script>
  
  <script>
    // Proteção de rotas - verificar se o usuário está logado
    document.addEventListener('DOMContentLoaded', function() {
      // DESATIVADO TEMPORARIAMENTE: Verificar se o usuário está logado
      // if (!AuthUtils.isLoggedIn()) {
      //   Utils.redirect('login.html');
      //   return;
      // }
      // if (AuthUtils.isTokenExpired()) {
      //   Utils.showToast('Sua sessão expirou. Faça login novamente.', 'warning');
      //   AuthUtils.logout();
      //   return;
      // }
      carregarInformacoesUsuario();
      configurarBotoes();
      carregarRelatorioEmpresa();
      carregarEstatisticasPorSetor();
    });
    
    // Função para carregar informações do usuário
    function carregarInformacoesUsuario() {
      const usuario = AuthUtils.getCurrentUser();
      
      if (usuario) {
        // Atualizar nome do usuário
        const userNameElement = document.getElementById('userName');
        const userEmailElement = document.getElementById('userEmail');
        const userInitialsElement = document.getElementById('userInitials');
        
        if (userNameElement) {
          userNameElement.textContent = usuario.nome || 'Usuário';
        }
        
        if (userEmailElement) {
          userEmailElement.textContent = usuario.email || 'usuario@email.com';
        }
        
        if (userInitialsElement) {
          const iniciais = Utils.getInitials(usuario.nome || 'U', 2);
          userInitialsElement.textContent = iniciais;
        }
      }
    }
    
    // Função para configurar o botão de logout
    function configurarLogout() {
      const logoutBtn = document.getElementById('logoutBtn');
      
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Confirmar logout
          if (confirm('Tem certeza que deseja sair?')) {
            Utils.showToast('Logout realizado com sucesso!', 'info');
            AuthUtils.logout();
          }
        });
      }
    }
    
    // Função para verificar periodicamente se o token expirou
    setInterval(function() {
      if (AuthUtils.isLoggedIn() && AuthUtils.isTokenExpired()) {
        Utils.showToast('Sua sessão expirou. Faça login novamente.', 'warning');
        AuthUtils.logout();
      }
    }, 120000);

    // Função para buscar e preencher os cartões do relatório da empresa
    async function carregarRelatorioEmpresa() {
      try {
        // Exemplo: período do mês atual
        const hoje = new Date();
        const inicio = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
        const fim = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
        const dataInicio = inicio.toISOString();
        const dataFim = fim.toISOString();
        
        const url = `${API_CONFIG.ENDPOINTS.RELATORIOS}/empresa?dataInicio=${dataInicio}&dataFim=${dataFim}`;
        const data = await API_CONFIG.authenticatedRequest(url);
        
        document.getElementById('cardSetores').textContent = data.quantidadeSetores;
        document.getElementById('cardEquipamentos').textContent = data.quantidadeEquipamentos;
        document.getElementById('cardTempoUso').textContent = `${data.tempoUsoTotal} h`;
        document.getElementById('cardGastoEnergetico').textContent = `${data.gastoEnergeticoTotal} kWh`;
      } catch (error) {
        document.getElementById('cardSetores').textContent = '-';
        document.getElementById('cardEquipamentos').textContent = '-';
        document.getElementById('cardTempoUso').textContent = '-';
        document.getElementById('cardGastoEnergetico').textContent = '-';
      }
    }

    // Função para preencher a tabela de estatísticas por setor
    async function carregarEstatisticasPorSetor() {
      try {
        // Buscar todos os setores
        const setoresResp = await API_CONFIG.authenticatedRequest(API_CONFIG.ENDPOINTS.SETORES);
        const setores = setoresResp.data || setoresResp;
        const hoje = new Date();
        const inicio = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
        const fim = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
        const dataInicio = inicio.toISOString();
        const dataFim = fim.toISOString();
        
        const tbody = document.getElementById('estatisticasSetoresBody');
        tbody.innerHTML = '';
        for (const setor of setores) {
          try {
            const url = `${API_CONFIG.ENDPOINTS.RELATORIOS}/setor/${setor.id}?dataInicio=${dataInicio}&dataFim=${dataFim}`;
            const relatorio = await API_CONFIG.authenticatedRequest(url);
            const row = document.createElement('tr');
            row.innerHTML = `
              <td class="p-2 align-middle bg-transparent border-b w-3/10 whitespace-nowrap dark:border-white/40">
                <div class="flex items-center px-2 py-1">
                  <div>
                    <img src="../assets/img/logo.svg" alt="Setor" />
                  </div>
                  <div class="ml-6">
                    <p class="mb-0 text-xs font-semibold leading-tight dark:text-white dark:opacity-60">Setor:</p>
                    <h6 class="mb-0 text-sm leading-normal dark:text-white">${relatorio.nomeSetor || setor.nome}</h6>
                  </div>
                </div>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap dark:border-white/40">
                <div class="text-center">
                  <p class="mb-0 text-xs font-semibold leading-tight dark:text-white dark:opacity-60">Equipamentos:</p>
                  <h6 class="mb-0 text-sm leading-normal dark:text-white">${relatorio.quantidadeEquipamentos}</h6>
                </div>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap dark:border-white/40">
                <div class="text-center">
                  <p class="mb-0 text-xs font-semibold leading-tight dark:text-white dark:opacity-60">Tempo de Uso:</p>
                  <h6 class="mb-0 text-sm leading-normal dark:text-white">${relatorio.tempoUsoTotal} h</h6>
                </div>
              </td>
              <td class="p-2 text-sm leading-normal align-middle bg-transparent border-b whitespace-nowrap dark:border-white/40">
                <div class="flex-1 text-center">
                  <p class="mb-0 text-xs font-semibold leading-tight dark:text-white dark:opacity-60">Gasto Energético:</p>
                  <h6 class="mb-0 text-sm leading-normal dark:text-white">${relatorio.gastoEnergeticoTotal} kWh</h6>
                </div>
              </td>
            `;
            tbody.appendChild(row);
          } catch (err) {
            // Se falhar para um setor, pula para o próximo
            continue;
          }
        }
      } catch (error) {
        // Se falhar geral, mostra mensagem
        const tbody = document.getElementById('estatisticasSetoresBody');
        tbody.innerHTML = `<tr><td colspan="4" class="text-center text-red-500">Erro ao carregar estatísticas dos setores</td></tr>`;
      }
    }
  </script>
</html>
